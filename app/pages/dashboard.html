{{if .IsHtmx}}
{{template "layouts/no-layout" .}}
{{else}}
{{template "layouts/main-layout" .}}
{{end}}

{{define "title"}}Dashboard{{end}}

{{define "content"}}
{{if not .IsHtmx}}
<h2>Dashboard</h2>

<form hx-get="/" hx-push-url="true" hx-trigger="change changed" hx-target="#dashboard-content"
   hx-indicator="#dashboard-spinner">
   <div class="grid">
      <select id="property_id" name="property_id">
         {{range .Properties}}
         <option value="{{.ID}}" {{if eq .ID $.SelectedPropertyID}}selected{{end}}>{{.Name}}</option>
         {{end}}
      </select>

      <select id="time_range" name="time_range">
         <option value="24h" {{if eq "24h" .SelectedTimeRange}}selected{{end}}>Last 24-hours</option>
         <option value="1d" {{if eq "1d" .SelectedTimeRange}}selected{{end}}>Yesterday</option>
         <option value="7d" {{if eq "7d" .SelectedTimeRange}}selected{{end}}>7 Days</option>
         <option value="30d" {{if eq "30d" .SelectedTimeRange}}selected{{end}}>30 Days</option>
         <option value="6m" {{if eq "6m" .SelectedTimeRange}}selected{{end}}>6 Months</option>
      </select>
   </div>
</form>

<div id="dashboard-spinner" class="htmx-indicator">
   <progress></progress>
</div>
{{end}}

<div id="dashboard-content">
   <article>
      <div id="pageViewsChartContainer" style="position: relative; height: 300px;">
         <canvas id="pageViewsChart"></canvas>
      </div>
   </article>

   <div class="grid">
      <article>
         <h4>Top Pages</h4>
         <table>
            <thead>
               <tr>
                  <th>Path</th>
                  <th>Views</th>
               </tr>
            </thead>
            <tbody>
               {{range .TopPaths}}
               <tr>
                  <td>{{.Path}}</td>
                  <td>{{.Count}}</td>
               </tr>
               {{end}}
            </tbody>
         </table>
      </article>

      <article>
         <h4>Views by Browser</h4>
         <table>
            <thead>
               <tr>
                  <th>Browser</th>
                  <th>Views</th>
               </tr>
            </thead>
            <tbody>
               {{range .BrowserCounts}}
               <tr>
                  <td>{{.Browser}}</td>
                  <td>{{.Count}}</td>
               </tr>
               {{end}}
            </tbody>
         </table>
      </article>

      <article>
         <h4>Views by Country</h4>
         <table>
            <thead>
               <tr>
                  <th>Country</th>
                  <th>Views</th>
               </tr>
            </thead>
            <tbody>
               {{range .CountryCounts}}
               <tr>
                  <td>{{.Country}}</td>
                  <td>{{.Count}}</td>
               </tr>
               {{end}}
            </tbody>
         </table>
      </article>
   </div>

   <script src="/static/js/pages/dashboard.js" type="module"></script>
   <script type="module">
      const init = () => {
         window.initDashboard({{.ViewsOverTimeLabelsJSON}}, {{.ViewsOverTimeDataJSON}});
   };

      document.addEventListener('DOMContentLoaded', init);
      document.addEventListener("htmx:afterSettle", init);
   </script>
</div>
{{end}}
